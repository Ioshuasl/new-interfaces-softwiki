<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <!-- Quill CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <title>Nova Averbação</title>
</head>

<body>
    <header>

    </header>

    <main>
        <div class="sidebar">
            <h2><a href="../../../index.html">Menu</a></h2>
            <ul>
                <li><a href="" class="submenu-toggle">
                        <h3>Registros</h3>
                    </a>
                    <ul class="submenu">
                        <li><a href="../index.html">Nascimento</a></li>
                        <li><a href="">Casamento</a></li>
                        <li><a href="">Obito</a></li>
                        <li><a href="">Natimorto</a></li>
                    </ul>
                </li>
                <li>
                    <a href="" class="submenu-toggle">
                        <h3>Configuração de Cadastro</h3>
                    </a>
                    <ul class="submenu">
                        <li><a href="">Cartório</a></li>
                        <li><a href="">Pessoas</a></li>
                        <li><a href="">Minuta</a></li>
                        <li><a href="">Livro</a></li>
                        <li><a href="">Complemento Pessoas</a></li>
                        <li><a href="">Outros Cartórios</a></li>
                        <li><a href="">CID</a></li>
                        <li><a href="">Tipo de Andamento</a></li>
                        <li><a href="">Tipo de Serviço</a></li>
                        <li><a href="">Livro E</a></li>
                        <li><a href="">Emolumentos</a></li>
                    </ul>
                </li>
                <li><a href="" class="submenu-toggle">
                        <h3>Integração</h3>
                    </a>
                    <ul class="submenu">
                        <li><a href="">CRC</a></li>
                        <li><a href="">SIRC</a></li>
                        <li><a href="">IBGE</a></li>
                        <li><a href="">Relatório Justiça <br>Eleitoral/Exercito</a></li>
                    </ul>
                </li>
                <li><a href="" class="submenu-toggle">
                        <h3>Impressão</h3>
                    </a>
                    <ul class="submenu">
                        <li><a href="">Impressão de Protocolo</a></li>
                    </ul>
                </li>
                <li><a href="" class="submenu-toggle">
                        <h3>Administração</h3>
                    </a>
                    <ul class="submenu">
                        <li><a href="">Controle de Marcação</a></li>
                    </ul>
                </li>
                <li><a href="">
                        <h3>Configuração do sistema</h3>
                    </a></li>
            </ul>
        </div>

        <div class="content">

            <div class="container">
                <input type="hidden" name="textoAverbacao" id="textoAverbacao">
                <form id="registro-form">
                    <h3>Nova Averbação</h3>

                    <div class="label-input-row">
                        <label for="">Dados do Registro Original</label>
                        <div class="input-dado-registro">
                            <select name="tipo-ato" id="tipo-ato">
                                <option value="">Selecione o Tipo de Ato</option>
                                <option value="nascimento">Nascimento</option>
                                <option value="casamento">Casamento</option>
                                <option value="obito">Óbito</option>
                                <option value="natimorto">Natimorto</option>
                            </select>
                            <input type="text" name="numero-termo" id="numero-termo"
                                placeholder="Nº do Termo do Registro">
                        </div>
                    </div>

                    <label for="modeloTexto">Modelo do Texto de Averbação:</label>
                    <select id="modeloTexto" onchange="inserirModelo()">
                        <option value="">Selecionar modelo</option>
                        <option value="modelo1">Modelo Judicial</option>
                        <option value="modelo2">Modelo Retificação</option>
                        <option value="">Alteração de Nome</option>
                        <option value="">Mudança de Estado Civil</option>
                        <option value="">Filiação</option>
                        <option value="">Averbação de Óbito</option>
                    </select>

                    <div class="label-input-row">
                        <label for="motivo-averbacao">Motivo da Averbação:</label>
                        <textarea name="motivo-averbacao" id="motivo-averbacao" rows="3"></textarea>
                    </div>

                    <div>
                        <h4>Dados de Registro da Averbação</h4>
                        <div style="display: flex; gap: 20px;margin-top: 20px;flex: 1;">
                            <div class="label-input-row" style="flex: none;width: 150px;">
                                <label>Data da Averbação:</label>
                                <input type="date" id="dataRegistro" />
                            </div>
                            <div class="label-input-row" style="flex: none; width: 150px;">
                                <label>Livro:</label>
                                <select id="livro">
                                    <option value="">Selecione</option>
                                    <option value="A - Nº 5">Livro A - Nº 5</option>
                                    <option value="B - Nº 3">Livro B - Nº 3</option>
                                </select>
                            </div>
                            <div class="label-input-row" style="flex: none;width: 120px;">
                                <label>Folha Inicial:</label>
                                <input type="text" id="folha-inicial" placeholder="Folha Inicial" />
                            </div>
                            <div class="label-input-row" style="flex: none;width: 120px;">
                                <label for="">Folha Final:</label>
                                <input type="text" id="folha-final" placeholder="Folha Final" />
                            </div>
                            <div class="label-input-row">
                                <label for="responsavel">Responsável pela Averbação:</label>
                                <select id="responsavel" name="responsavel" required>
                                    <option value="">Selecione</option>
                                    <option value="dr_jose_silva">Dr. José Silva (Titular)</option>
                                    <option value="dra_maria_almeida">Dra. Maria Almeida (Escrivão)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="requerente">
                        <h4>Dados do Requerente:</h4>

                        <!-- Tipo de Pessoa -->
                        <div class="input-row" style="display: flex; align-items:safe; gap: 20px;">
                            <label for="tipo-requerente">Tipo de Requerente:</label>
                            <select id="tipo-requerente">
                                <option value="" selected>Selecione</option>
                                <option value="pf">Pessoa Física</option>
                                <option value="pj">Pessoa Jurídica</option>
                            </select>
                        </div>

                        <!-- Bloco Dinâmico - Mostra conforme tipo selecionado -->
                        <div id="bloco-pf" style="display: none;">
                            <label for="nome-mae">Nome completo:</label>
                            <div class="input-nome-pais-pesquisar">
                                <input type="text" id="nome" name="nome" placeholder="Nome" required>
                                <button type="button">Pesquisar</button>
                            </div>

                            <div class="cpf-dataNascimento-documento">
                                <div class="label-input-row cpf">
                                    <label for="cpf">Cpf:</label>
                                    <input type="text" id="cpf" name="cpf" placeholder="___.___.___-__" required>
                                </div>
                                <div class="label-input-row">
                                    <label for="data-nascimento-mae">Data de nascimento:</label>
                                    <input type="date" id="data-nascimento" name="data-nascimento" required>
                                </div>
                                <div class="label-input-row">
                                    <label for="documento">Tipo do Documento:</label>
                                    <select id="tipo-documento" name="tipo-documento" required>
                                        <option value="rg">RG</option>
                                        <option value="cnh">CNH</option>
                                        <option value="cpf">CPF</option>
                                        <option value="passaporte">Passaporte</option>
                                    </select>
                                </div>

                                <div class="label-input-row">
                                    <label for="numero-documento">Númmero do Documento:</label>
                                    <input type="text" name="numero-documento" id="numero-documento">
                                </div>
                            </div>

                            <div class="naturalidade-nacionalidade-pais">
                                <div class="label-input-row">
                                    <label for="nacionalidade-mae">Nacionalidade:</label>
                                    <select id="nacionalidade-mae" name="nacionalidade-mae" required>
                                        <option value="brasileira">Brasileira</option>
                                        <option value="estrangeira">Estrangeira</option>
                                    </select>
                                </div>

                                <div class="label-input-row">
                                    <label for="naturalidade">Naturalidade:</label>
                                    <input list="naturalidade-list" id="naturalidade" name="naturalidade">
                                    <datalist id="naturalidade-list">
                                        <option value="Goiânia"></option>
                                        <option value="Anápolis"></option>
                                        <option value="Aparecida de Goiânia"></option>
                                    </datalist>
                                </div>

                                <div class="label-input-row" id="uf">
                                    <label for="estado-naturalidade-nubente">UF:</label>
                                    <input type="text" name="estado-naturalidade-nubente"
                                        id="estado-naturalidade-nubente">
                                </div>
                            </div>

                            <div class="profissao-estado-civil-anterior">
                                <div class="label-input-row">
                                    <label for="profissao">Profissão:</label>
                                    <input type="text" id="profissao" name="profissao" required>
                                </div>

                                <div class="label-input-row">
                                    <label for="estadoCivilAnterior">Estado Civil:</label>
                                    <select id="estadoCivilAnterior" name="estadoCivilAnterior" required>
                                        <option value="" disabled selected>Selecione</option>
                                        <option value="solteiro">Solteiro(a)</option>
                                        <option value="casado">Casado</option>
                                        <option value="divorciado">Divorciado(a)</option>
                                        <option value="viuvo">Viúvo(a)</option>
                                    </select>
                                </div>
                            </div>

                            <label for="endereco">Endereço completo:</label>
                            <div class="form-container">
                                <div class="input-row">
                                    <input type="text" id="rua" name="rua" placeholder="Rua" required>
                                    <input type="text" id="numero" name="numero" placeholder="Número" required>
                                </div>

                                <div class="input-row-cidade">
                                    <input type="text" id="bairro" name="bairro" placeholder="Bairro" required>
                                    <input type="text" id="cidade" name="cidade" placeholder="Cidade" required>
                                    <input type="text" id="estado" name="estado" placeholder="Estado" required>
                                </div>
                                <div class="cep">
                                    <input type="text" id="cep" name="cep" placeholder="CEP" required>
                                    <button type="button">Pesquisar</button>
                                </div>
                            </div>
                        </div>

                        <!-- Bloco PJ -->
                        <div id="bloco-pj" style="display: none;">
                            <div class="input-row">
                                <div class="label-input-row">
                                    <label>Razão Social:</label>
                                    <input type="text" id="razao-social" required />
                                </div>
                                <div class="label-input-row">
                                    <label>CNPJ:</label>
                                    <div style="display: flex;gap: 20px; flex: 1;padding-bottom: 15px;">
                                        <input type="text" id="cnpj" placeholder="__.___.___/____-__" required
                                            style="margin-bottom: 0px; flex: 1;" />
                                        <button>Pesquisar CNPJ</button>
                                    </div>
                                </div>
                            </div>

                            <div class="input-row">
                                <div class="label-input-row">
                                    <label>Nome Fantasia:</label>
                                    <input type="text" id="nome-fantasia" />
                                </div>
                                <div class="label-input-row">
                                    <label>Natureza Jurídica:</label>
                                    <input type="text" id="natureza-juridica" />
                                </div>
                            </div>

                            <div class="label-input-row">
                                <label>Endereço:</label>
                                <input type="text" id="endereco-pj" placeholder="Logradouro, nº" />
                            </div>
                            <div class="input-row">
                                <div class="label-input-row">
                                    <input type="text" id="bairro-pj" placeholder="Bairro" />
                                </div>
                                <div class="label-input-row">
                                    <input type="text" id="cidade-pj" placeholder="Cidade" />
                                </div>
                                <div class="label-input-row" id="uf">
                                    <input type="text" id="uf-pj" placeholder="UF" maxlength="2" />
                                </div>
                            </div>
                            <div class="input-row">
                                <div class="label-input-row">
                                    <input type="text" id="cep-pj" placeholder="CEP" />
                                </div>
                                <div class="label-input-row">
                                    <input type="tel" id="telefone-pj" placeholder="(99) 99999-9999" />
                                </div>
                                <div class="label-input-row">
                                    <input type="email" id="email-pj" placeholder="E-mail" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pessoas" style="margin-bottom: 20px;">
                        <h4>Pessoas Vinculadas à Averbação</h4>
                        <div id="pessoas-vinculadas">
                            <div class="pessoa-item">
                                <div class="pessoa-item-select">
                                    <select name="pessoa[]" class="selecao-pessoa">
                                        <option value="">Selecione uma pessoa</option>
                                        <option value="joao_silva">João da Silva (CPF: 123.456.789-00)</option>
                                        <option value="maria_santos">Maria dos Santos (CPF: 987.654.321-00)</option>
                                    </select>
                                    <button type="button" class="cadastrar-pessoa" onclick="abrirCadastroRapido()">+ Cadastrar Nova
                                        Pessoa</button>
                                </div>
                            </div>
                        </div>

                        <button type="button" onclick="adicionarPessoa()">+ Adicionar outra pessoa</button>
                    </div>

                    <div id="modal-cadastro-rapido" class="modal-cadastro-rapido">
                        <div class="modal-cadastro-rapido-conteudo">
                            <h2>Cadastro de Pessoa</h2>
                            <div>
                                <label for="nome-mae">Nome completo:</label>
                                <div class="input-nome-pais-pesquisar">
                                    <input type="text" id="nome" name="nome" placeholder="Nome" required>
                                    <button type="button">Pesquisar</button>
                                </div>

                                <div class="cpf-dataNascimento-documento">
                                    <div class="label-input-row cpf">
                                        <label for="cpf">Cpf:</label>
                                        <input type="text" id="cpf" name="cpf" placeholder="___.___.___-__" required>
                                    </div>
                                    <div class="label-input-row">
                                        <label for="data-nascimento-mae">Data de nascimento:</label>
                                        <input type="date" id="data-nascimento" name="data-nascimento" required>
                                    </div>
                                    <div class="label-input-row">
                                        <label for="documento">Tipo do Documento:</label>
                                        <select id="tipo-documento" name="tipo-documento" required>
                                            <option value="rg">RG</option>
                                            <option value="cnh">CNH</option>
                                            <option value="cpf">CPF</option>
                                            <option value="passaporte">Passaporte</option>
                                        </select>
                                    </div>

                                    <div class="label-input-row">
                                        <label for="numero-documento">Númmero do Documento:</label>
                                        <input type="text" name="numero-documento" id="numero-documento">
                                    </div>
                                </div>

                                <div class="naturalidade-nacionalidade-pais">
                                    <div class="label-input-row">
                                        <label for="nacionalidade-mae">Nacionalidade:</label>
                                        <select id="nacionalidade-mae" name="nacionalidade-mae" required>
                                            <option value="brasileira">Brasileira</option>
                                            <option value="estrangeira">Estrangeira</option>
                                        </select>
                                    </div>

                                    <div class="label-input-row">
                                        <label for="naturalidade">Naturalidade:</label>
                                        <input list="naturalidade-list" id="naturalidade" name="naturalidade">
                                        <datalist id="naturalidade-list">
                                            <option value="Goiânia"></option>
                                            <option value="Anápolis"></option>
                                            <option value="Aparecida de Goiânia"></option>
                                        </datalist>
                                    </div>

                                    <div class="label-input-row" id="uf">
                                        <label for="estado-naturalidade-nubente">UF:</label>
                                        <input type="text" name="estado-naturalidade-nubente"
                                            id="estado-naturalidade-nubente">
                                    </div>
                                </div>

                                <div class="profissao-estado-civil-anterior">
                                    <div class="label-input-row">
                                        <label for="profissao">Profissão:</label>
                                        <input type="text" id="profissao" name="profissao" required>
                                    </div>

                                    <div class="label-input-row">
                                        <label for="estadoCivilAnterior">Estado Civil:</label>
                                        <select id="estadoCivilAnterior" name="estadoCivilAnterior" required>
                                            <option value="" disabled selected>Selecione</option>
                                            <option value="solteiro">Solteiro(a)</option>
                                            <option value="casado">Casado</option>
                                            <option value="divorciado">Divorciado(a)</option>
                                            <option value="viuvo">Viúvo(a)</option>
                                        </select>
                                    </div>
                                </div>

                                <label for="endereco">Endereço completo:</label>
                                <div class="form-container">
                                    <div class="input-row">
                                        <input type="text" id="rua" name="rua" placeholder="Rua" required>
                                        <input type="text" id="numero" name="numero" placeholder="Número" required>
                                    </div>

                                    <div class="input-row-cidade">
                                        <input type="text" id="bairro" name="bairro" placeholder="Bairro" required>
                                        <input type="text" id="cidade" name="cidade" placeholder="Cidade" required>
                                        <input type="text" id="estado" name="estado" placeholder="Estado" required>
                                    </div>
                                    <div class="cep">
                                        <input type="text" id="cep" name="cep" placeholder="CEP" required>
                                        <button type="button">Pesquisar</button>
                                    </div>
                                </div>
                            </div>
                            <div style="margin-top: 10px;">
                                <button type="button" onclick="salvarNovaPessoa()">Salvar</button>
                                <button type="button" onclick="fecharCadastroRapido()">Fechar</button>
                            </div>
                        </div>
                    </div>

                    <div class="texto-averbacao">
                        <label for="observacoes">Texto de Averbação:</label>
                        <div class="botoes-texto-averbacao">
                            <button type="button">Qualificar Texto</button>
                            <button type="button">Limpar texto</button>
                            <button type="button" onclick="visualizarAverbacao()">Visualizar como Folha</button>
                            <button type="button" onclick="exportarPDF()">Exportar como PDF</button>
                            <button type="button" onclick="imprimirAverbacao()">Imprimir Averbação</button>
                        </div>
                        <div class="editor">
                            <!-- Toolbar padrão do Quill -->
                            <div id="toolbar">
                                <span class="ql-formats">
                                    <button class="ql-bold"></button>
                                    <button class="ql-italic"></button>
                                    <button class="ql-underline"></button>
                                    <button class="ql-strike"></button>
                                    <select class="ql-size">
                                        <option value="12px">12px</option>
                                        <option value="14px" selected>14px</option>
                                        <option value="16px">16px</option>
                                        <option value="18px">18px</option>
                                        <option value="24px">24px</option>
                                        <option value="32px">32px</option>
                                    </select>
                                    <select class="ql-font">
                                        <option value="sans-serif"></option>
                                        <option value="serif"></option>
                                        <option value="monospace"></option>
                                    </select>
                                    <select class="ql-color"></select>
                                    <select class="ql-background"></select>
                                    <button class="ql-list" value="ordered"></button>
                                    <button class="ql-list" value="bullet"></button>
                                    <button class="ql-blockquote"></button>
                                    <button class="ql-link"></button>
                                    <button class="ql-image"></button>
                                    <button class="ql-video"></button>
                                    <button class="ql-clean"></button> <!-- Limpar formatação -->
                                </span>
                                <span class="ql-formats">
                                    <select class="ql-header">
                                        <option value="1">Cabeçalho 1</option>
                                        <option value="2">Cabeçalho 2</option>
                                        <option value="3">Cabeçalho 3</option>
                                        <option value="4">Cabeçalho 4</option>
                                        <option value="5">Cabeçalho 5</option>
                                        <option value="6">Cabeçalho 6</option>
                                        <option selected></option>
                                    </select>
                                    <select class="ql-align">
                                        <option value=""></option>
                                        <option value="center"></option>
                                        <option value="right"></option>
                                        <option value="justify"></option>
                                    </select>
                                </span>
                            </div>

                            <!-- Área editável do Quill -->
                            <div id="editor-container"></div>
                        </div>
                    </div>

                    <div id="modal-folha" class="modal">
                        <div class="modal-folha">
                            <span class="close" onclick="fecharFolha()">&times;</span>
                            <div id="folha-preview" style="display:none; margin-top: 10px;">
                                <div class="folha-a4">
                                    <div id="preview-content"></div>
                                    <div id="qr-code-container" style="width: 120px; height: 120px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="selo-averbacao">
                        <label for="selo-averbacao-nascimento">Selo de Averbação:</label>
                        <div class="botao-selo">
                            <button type="button" onclick="gerarSelo()">Gerar Selo de Averbação</button>
                        </div>
                        <input type="text" name="selo-averbacao-nascimento" id="selo-averbacao-nascimento"
                            placeholder="Número do selo">
                    </div>

                    <label for="dnv">Documento Anexo (Opcional):</label>
                    <input type="file" id="dnv" name="dnv" accept=".pdf,.jpg,.jpeg,.png">

                    <div class="assinatura-digital" style="margin-bottom: 15px;">
                        <button type="button" onclick="assinarDocumento()">
                            <strong>Assinar Digitalmente</strong>
                        </button>
                        <p id="status-assinatura"></p>
                    </div>

                    <div class="valor-certidao">
                        <div class="detalhes-pagamento">
                            <h3>Resumo de Pagamento</h3>
                            <p><strong>Valor da Certidão:</strong> R$ 45,00</p>
                            <p><strong>Taxa de Emissão:</strong> R$ 15,00</p>
                            <p><strong>Total a Pagar:</strong> <span class="valor-final">R$ 60,00</span></p>
                        </div>

                        <div class="opcao-pagamento">
                            <label for="formaPagamento"><strong>Forma de Pagamento:</strong></label>
                            <select id="formaPagamento" required>
                                <option value="">Selecione</option>
                                <option value="boleto">Boleto Bancário</option>
                                <option value="cartao">Cartão de Crédito</option>
                                <option value="pix">Pix</option>
                            </select>
                        </div>
                    </div>
                </form>
                <div class="botoes">
                    <button type="button" onclick="window.history.back();">Cancelar</button>
                    <button type="submit" onclick="confimacaoAverbacao()">Confirmar e Emitir Averbação</button>
                </div>

                <div id="modal-confirmacao" class="modal">
                    <div class="modal-conteudo"
                        style="display: flex;flex-direction: column;background-color: white; width: 400px; height: 200px; align-items: center; justify-content: center;">
                        <h3>Confirmar emissão</h3>
                        <p>Deseja realmente emitir esta averbação?</p>
                        <div>
                            <button onclick="confirmarEmissao()">Sim</button>
                            <button onclick="fecharModal()">Não</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </main>

    <!-- Quill JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>

        const Size = Quill.import('formats/size');
        Size.whitelist = ['12px', '14px', '16px', '18px', '24px', '32px'];
        Quill.register(Size, true);


        const quill = new Quill('#editor-container', {
            modules: {
                toolbar: {
                    container: '#toolbar'
                }
            },
            theme: 'snow'
        });


        // Adicionando um listener para o cabeçalho
        const headerSelect = document.querySelector('.ql-header');
        headerSelect.addEventListener('change', function () {
            const header = this.value;
            quill.format('header', header);
        });

        // Adicionando um listener para o alinhamento
        const alignSelect = document.querySelector('.ql-align');
        alignSelect.addEventListener('change', function () {
            const align = this.value;
            quill.format('align', align);
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const submenuToggles = document.querySelectorAll('.submenu-toggle');

            submenuToggles.forEach(toggle => {
                toggle.addEventListener('click', function (event) {
                    event.preventDefault(); // Previne o comportamento padrão do link
                    const submenu = this.nextElementSibling; // Seleciona o submenu associado

                    // Alterna a visibilidade do submenu
                    if (submenu.style.display === 'block') {
                        submenu.style.display = 'none';
                    } else {
                        submenu.style.display = 'block';
                    }
                });
            });
        });

        function visualizarAverbacao() {
            const previewContainer = document.getElementById('preview-content');
            const modal = document.getElementById('modal-folha');
            const folhaPreview = document.getElementById('folha-preview');

            // Copiar o conteúdo do editor Quill para a área de visualização
            const styledContent = document.createElement('div');
            styledContent.classList.add('ql-editor');
            styledContent.innerHTML = quill.root.innerHTML;

            previewContainer.innerHTML = '';
            previewContainer.appendChild(styledContent)

            // Agora, garantir que o QR Code do rodapé também seja incluído
            // A ideia é verificar se existe um QR Code no editor e adicioná-lo à pré-visualização
            const qrCodeImage = document.querySelector('#editor-container img'); // Encontrar o QR Code inserido

            if (qrCodeImage) {
                const qrCodeClone = qrCodeImage.cloneNode(); // Clonar o QR Code para a pré-visualização
                const qrcode = previewContainer.appendChild(qrCodeClone); // Adicionar o QR Code na pré-visualização
            }


            folhaPreview.style.display = 'block';
            modal.style.display = 'flex'; // Mostrar o modal com a pré-visualização
        }



        function fecharFolha() {
            document.getElementById("modal-folha").style.display = "none";
        }

        // Fecha o modal ao clicar fora
        window.onclick = function (event) {
            const modal = document.getElementById("modal-folha");
            if (event.target === modal) {
                modal.style.display = "none";
            }
        }

        document.getElementById('registro-form').addEventListener('submit', function (e) {
            document.getElementById('textoAverbacao').value = quill.root.innerHTML;
        });


        function exportarPDF() {
            const folha = document.querySelector('.folha-a4');

            const opt = {
                margin: 0,
                filename: 'averbacao.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(folha).save();
        }
    </script>

    <script>
        function inserirModelo() {
            const modelo = document.getElementById("modeloTexto").value;

            if (modelo === "modelo1") {
                const conteudoHTML = `
            <h2 style="text-align: center;">Averbação Judicial</h2>
            <br>
            <p><strong>Decisão nº:</strong> 12345/2024</p>
            <p><span style="font-size: 16px;">Conforme decisão do juiz da 1ª Vara Cível de São Paulo...</span></p>
        `;
                quill.clipboard.dangerouslyPasteHTML(conteudoHTML);
            } else if (modelo === "modelo2") {
                const conteudoHTML = `
            <h3 style="color: #007BFF;">Retificação Administrativa</h3>
            <p style="font-family: serif; font-size: 15px;">
                Foi identificada divergência no nome da genitora, sendo corrigido para o nome completo conforme documento apresentado.
            </p>
        `;
                quill.clipboard.dangerouslyPasteHTML(conteudoHTML);
            }
        }
    </script>

    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>

    <script>
        function gerarSelo() {
            // Gerar um código único para o selo
            const seloCodigo = "08271504271620139500504"

            // Preencher o campo de input com o código do selo
            document.getElementById('selo-averbacao-nascimento').value = seloCodigo;

            // Criar o QR Code para o selo
            const qrCodeContainer = document.createElement('div');
            qrCodeContainer.className = 'qr-code-container'; // Adiciona a classe para o estilo
            qrCodeContainer.style.width = '40px';
            qrCodeContainer.style.height = '40px';

            // Gerar o QR Code
            new QRCode(qrCodeContainer, {
                text: `https://see.tjgo.jus.br/buscas?codigo_selo=${seloCodigo}`,
                width: 80,
                height: 80,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            // Agora insere o QR Code no rodapé do editor de texto (editor-container)
            const editorContainer = document.getElementById('editor-container');

            // Limpa o conteúdo anterior do editor antes de adicionar o QR Code
            const existingQRCode = editorContainer.querySelector('.qr-code-container');
            if (existingQRCode) {
                existingQRCode.remove(); // Remove o QR Code anterior, se existir
            }

            // Adiciona o QR Code ao final do editor
            editorContainer.appendChild(qrCodeContainer);
        }
    </script>

    <script>
        function imprimirAverbacao() {
            // Seleciona o conteúdo que você deseja imprimir
            var conteudo = quill.root.innerHTML; // Obtém o conteúdo diretamente do Quill

            const qrCode = document.querySelector('#editor-container .qr-code-container');

            if (!qrCode) {
                alert("QR Code não foi gerado ainda.");
                return;
            }

            // Cria uma nova janela
            var janela = window.open('', '_blank', `top=0,left=0,width=${screen.availWidth},height=${screen.availHeight}`);
            janela.document.write('<html><head><title></title>');
            janela.document.write('<link rel="stylesheet" href="styles.css">'); // Inclui o CSS, se necessário
            janela.document.write('<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">');
            janela.document.write('</head><body>');
            janela.document.write('<div class="ql-editor">' + conteudo + '</div>'); // Adiciona o conteúdo que você deseja imprimir
            janela.document.write(qrCode.outerHTML)
            janela.document.close(); // Fecha o documento

            janela.onload = () => {
                janela.focus()
                janela.print()
                janela.close()
            }
        }
    </script>

    <script>
        document.getElementById("tipo-requerente").addEventListener("change", function () {
            const pf = document.getElementById("bloco-pf");
            const pj = document.getElementById("bloco-pj");

            if (this.value === "pf") {
                pf.style.display = "block";
                pj.style.display = "none";
            } else if (this.value === "pj") {
                pf.style.display = "none";
                pj.style.display = "block";
            } else {
                pf.style.display = 'none'
                pj.style.display = 'none'
            }
        });
    </script>

    <script>
        function assinarDocumento() {
            const responsavel = document.getElementById("responsavel").value;
            const textoAverbacao = quill.root.innerHTML;

            if (!responsavel) {
                alert("Selecione um responsável antes de assinar.");
                return;
            }

            // Aqui entra a lógica real de assinatura
            if (confirm("Você deseja assinar esse documento digitalmente?")) {
                try {
                    // Simular assinatura (substituir por chamada real)
                    const hash = calcularHash(textoAverbacao);
                    const assinaturaDigital = simularAssinatura(hash);

                    // Mostrar status
                    document.getElementById("status-assinatura").innerHTML = `
                ✅ Documento assinado por <strong>${responsavel}</strong><br>
                Hash: ${hash.substring(0, 20)}...<br>
                Assinatura: ${assinaturaDigital.substring(0, 20)}...
            `;

                    // Desabilitar edição após assinatura
                    quill.enable(false);

                    alert("Documento assinado com sucesso!");

                } catch (error) {
                    console.error(error);
                    alert("Erro ao assinar o documento.");
                }
            }
        }

        // Função simulada de hash
        function calcularHash(data) {
            // Em produção, usar crypto-js ou outra biblioteca para gerar SHA-256
            return btoa(data).substring(0, 40); // Base64 truncado (simulação)
        }

        // Função simulada de assinatura
        function simularAssinatura(hash) {
            return `${hash}-assinado`;
        }
    </script>

    <script>
        function confirmarEmissao() {
            alert("Averbação emitida com sucesso!");
            // Aqui viria a chamada ao backend
        }
        function fecharModal() {
            document.getElementById("modal-confirmacao").style.display = "none";
        }
    </script>

    <script>
        function confimacaoAverbacao() {
            const popup = document.getElementById("modal-confirmacao")
            popup.style.display = 'flex'
        }
    </script>

    <script>
        function adicionarPessoa() {
            const container = document.getElementById("pessoas-vinculadas");
            const div = document.createElement("div");
            div.className = "pessoa-item";
            div.innerHTML = `
                <div class="pessoa-item-select">
                    <select name="pessoa[]" class="selecao-pessoa">
                        <option value="">Selecione uma pessoa</option>
                        <option value="joao_silva">João da Silva (CPF: 123.456.789-00)</option>
                        <option value="maria_santos">Maria dos Santos (CPF: 987.654.321-00)</option>
                    </select>
                    <button type="button" class="cadastrar-pessoa" onclick="abrirCadastroRapido()">+ Cadastrar Nova Pessoa</button>
                    <button type="button" class="remover-pessoa" onclick="removerPessoa(this)">Remover</button>
                </div>
    `;
            container.appendChild(div);
        }

        function removerPessoa(btn) {
            btn.parentNode.remove();
        }

        // Abre o modal
        function abrirCadastroRapido() {
            document.getElementById("modal-cadastro-rapido").style.display = "block";
        }

        // Fecha o modal
        function fecharCadastroRapido() {
            document.getElementById("modal-cadastro-rapido").style.display = "none";
            // Limpar campos
            document.getElementById("nome-nova-pessoa").value = "";
            document.getElementById("cpf-nova-pessoa").value = "";
            document.getElementById("data-nasc-nova-pessoa").value = "";
            document.getElementById("naturalidade-nova-pessoa").value = "";
        }
    </script>

    <script>
        function salvarNovaPessoa() {
            const nome = document.getElementById("nome").value;
            const cpf = document.getElementById("cpf").value;

            if (!nome || !cpf) {
                alert("Nome e CPF são obrigatórios.");
                return;
            }

            // Salvar pessoa temporariamente
            let pessoas = JSON.parse(localStorage.getItem("pessoas")) || [];
            pessoas.push({ nome, cpf });
            localStorage.setItem("pessoas", JSON.stringify(pessoas));

            // Atualizar selects
            atualizarSelectsPessoas();

            // Fechar modal
            fecharCadastroRapido();
            alert("Pessoa cadastrada com sucesso!");
        }

        function atualizarSelectsPessoas() {
            const selects = document.querySelectorAll(".selecao-pessoa");
            const pessoas = JSON.parse(localStorage.getItem("pessoas")) || [];

            selects.forEach(select => {
                select.innerHTML = '<option value="">Selecione uma pessoa</option>';
                pessoas.forEach(p => {
                    const option = document.createElement("option");
                    option.value = p.cpf;
                    option.textContent = `${p.nome} (CPF: ${p.cpf})`;
                    select.appendChild(option);
                });
            });
        }
    </script>
</body>

</html>